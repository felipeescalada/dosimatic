{
	"info": {
		"_postman_id": "secwin-documentos-collection",
		"name": "SecWin - Sistema de Documentos",
		"description": "Flujo completo de gestiÃ³n de documentos: CreaciÃ³n â†’ AprobaciÃ³n â†’ Firma â†’ Descarga",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. CONFIGURACIÃ“N INICIAL",
			"item": [
				{
					"name": "1.1 Obtener Gestiones",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/gestiones",
							"host": ["{{base_url}}"],
							"path": ["api", "gestiones"]
						}
					},
					"response": []
				},
				{
					"name": "1.2 Obtener Usuarios",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/users",
							"host": ["{{base_url}}"],
							"path": ["api", "users"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "2. CREACIÃ“N DE DOCUMENTO",
			"item": [
				{
					"name": "2.1 Crear Documento (Word/Excel)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('documento_id', response.data.id);",
									"    console.log('Documento creado con ID:', response.data.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "codigo",
									"value": "DOC-{{$randomInt}}",
									"type": "text"
								},
								{
									"key": "nombre",
									"value": "Documento de Prueba {{$randomFirstName}}",
									"type": "text"
								},
								{
									"key": "descripcion",
									"value": "Documento para testing del flujo completo",
									"type": "text"
								},
								{
									"key": "gestion_id",
									"value": "1",
									"type": "text"
								},
								{
									"key": "convencion",
									"value": "Manual",
									"type": "text"
								},
								{
									"key": "usuario_creador",
									"value": "1",
									"type": "text"
								},
								{
									"key": "archivo_fuente",
									"type": "file",
									"src": []
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/documentos",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos"]
						}
					},
					"response": []
				},
				{
					"name": "2.2 Verificar Documento Creado",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "3. APROBACIÃ“N DE DOCUMENTO",
			"item": [
				{
					"name": "3.1 Listar Documentos Pendientes de AprobaciÃ³n",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/aprobacion/pendientes",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "aprobacion", "pendientes"]
						}
					},
					"response": []
				},
				{
					"name": "3.2 Aprobar Documento",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"usuario_aprobador\": 2,\n  \"comentarios\": \"Documento aprobado para firma\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}/aprobacion",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}", "aprobacion"]
						}
					},
					"response": []
				},
				{
					"name": "3.3 Verificar Estado Aprobado",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "4. GESTIÃ“N DE FIRMAS",
			"item": [
				{
					"name": "4.1 Subir Firma de Usuario (Opcional)",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "signature",
									"type": "file",
									"src": []
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/users/{{usuario_firmante}}/signature",
							"host": ["{{base_url}}"],
							"path": ["api", "users", "{{usuario_firmante}}", "signature"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "5. FIRMA DIRECTA (Word/Excel sin PDF)",
			"item": [
				{
					"name": "5.0 NOTA: Firma directa Word/Excel",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "# IMPORTANTE: Este flujo firma documentos Word/Excel directamente usando Python script. No requiere conversiÃ³n a PDF.",
							"host": ["# IMPORTANTE: Este flujo firma documentos Word/Excel directamente usando Python script. No requiere conversiÃ³n a PDF."]
						}
					},
					"response": []
				},
				{
					"name": "5.1 Firmar Documento (Firma por Defecto)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    console.log('âœ… Documento firmado exitosamente');",
									"    console.log('ðŸ“„ Archivo:', response.signed_file_path);",
									"    console.log('ðŸ”— Descarga:', response.download_url);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"signer_name\": \"{{signer_name}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}/firmar",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}", "firmar"]
						}
					},
					"response": []
				},
				{
					"name": "5.2 Firmar Documento (Firma de Usuario)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    console.log('âœ… Documento firmado con firma personalizada');",
									"    console.log('ðŸ“„ Archivo:', response.signed_file_path);",
									"    console.log('ðŸ”— Descarga:', response.download_url);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"signer_name\": \"{{signer_name}}\",\n  \"usuario_firmante\": {{usuario_firmante}}\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}/firmar",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}", "firmar"]
						}
					},
					"response": []
				},
				{
					"name": "5.3 Verificar Estado Firmado",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "6. DESCARGA DE ARCHIVOS",
			"item": [
				{
					"name": "6.1 Descargar Archivo Original",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}/download/fuente",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}", "download", "fuente"]
						}
					},
					"response": []
				},
				{
					"name": "6.2 Descargar Archivo Firmado",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}/download/signed",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}", "download", "signed"]
						}
					},
					"response": []
				},
				{
					"name": "6.3 Convertir a PDF (Opcional - Solo si necesita PDF)",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}/convertir-pdf",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}", "convertir-pdf"]
						}
					},
					"response": []
				},
				{
					"name": "6.4 Descargar PDF (Solo despuÃ©s de conversiÃ³n)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}/download/pdf",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}", "download", "pdf"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "7. CONSULTAS ADICIONALES",
			"item": [
				{
					"name": "7.1 Listar Todos los Documentos",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos"]
						}
					},
					"response": []
				},
				{
					"name": "7.2 Obtener HistÃ³rico del Documento",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/{{documento_id}}/historico",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "{{documento_id}}", "historico"]
						}
					},
					"response": []
				},
				{
					"name": "7.3 Filtrar Documentos por Estado",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos?estado=aprobado",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos"],
							"query": [
								{
									"key": "estado",
									"value": "aprobado"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "7.4 Filtrar por GestiÃ³n",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos?gestion_id=1",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos"],
							"query": [
								{
									"key": "gestion_id",
									"value": "1"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "8. CASOS DE ERROR",
			"item": [
				{
					"name": "8.1 Intentar Firmar Documento No Aprobado",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"signer_name\": \"Test Error\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/documentos/999/firmar",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "999", "firmar"]
						}
					},
					"response": []
				},
				{
					"name": "8.2 Documento No Encontrado",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/documentos/99999",
							"host": ["{{base_url}}"],
							"path": ["api", "documentos", "99999"]
						}
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3500"
		},
		{
			"key": "documento_id",
			"value": ""
		},
		{
			"key": "signer_name",
			"value": "Juan PÃ©rez"
		},
		{
			"key": "usuario_firmante",
			"value": "1"
		}
	]
}
